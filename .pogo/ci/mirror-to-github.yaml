version: 1
on:
  push:
    bookmarks:
      - main
do:
  - type: container
    container:
      image: alpine:latest
      environment:
        GITHUB_TOKEN: '{{ secret "GITHUB_TOKEN" }}'
        GITHUB_REPO: pogo-vcs/pogo
      commands:
        - sh
        - -c
        - |
          set -e
          apk add --no-cache git
          echo "Cloning repo..."
          git clone https://${GITHUB_TOKEN}@github.com/${GITHUB_REPO}.git /github_repo
          echo "Repo cloned"
          mv /github_repo/.git /workspace/
          git config user.name "{{ .Author }}"
          git config user.email "{{ .Author }}@pogo.bloodmagesoftware.de"
          git add -A
          if git diff --staged --quiet; then
            echo "No changes to commit"
          else
            git commit -m '{{ .Description }}'
            echo "Pushing to GitHub..."
            git push origin main

            echo "Successfully mirrored to GitHub!"
          fi
