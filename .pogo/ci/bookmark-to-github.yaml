version: 1
on:
  push:
    bookmarks:
      - v*
do:
  - type: container
    container:
      image: alpine:latest
      environment:
        GITHUB_TOKEN: '{{ secret "GITHUB_TOKEN" }}'
        GITHUB_REPO: pogo-vcs/pogo
      commands:
        - sh
        - -c
        - |
          set -e
          apk add --no-cache git
          echo "Cloning repo..."
          git clone https://${GITHUB_TOKEN}@github.com/${GITHUB_REPO}.git /github_repo
          echo "Repo cloned"
          cd /github_repo
          git config user.name "{{ .Author }}"
          git config user.email "{{ .Author }}@pogo.bloodmagesoftware.de"
          git tag '{{ .Rev }}'
          echo "Pushing to GitHub..."
          git push origin 'refs/tags/{{ .Rev }}:refs/tags/{{ .Rev }}'
          echo "Successfully mirrored to GitHub!"
